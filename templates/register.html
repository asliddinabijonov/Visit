{% load static %}
<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ro‘yxatdan o‘tish</title>
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(rgba(0,0,0,0.6), rgba(0,0,0,0.6)),
                        url("{% static 'img/bg-tour.jpg' %}") center/cover no-repeat;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .register-card {
            background: rgba(255, 255, 255, 0.97);
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(0,0,0,0.4);
            padding: 40px;
            width: 100%;
            max-width: 500px;
        }
        .form-control, .form-select, textarea {
            border-radius: 10px;
            padding: 10px 12px;
            margin-bottom: 15px;
        }
        .btn-primary {
            width: 100%;
            border-radius: 10px;
            font-weight: 600;
        }
        h2 {
            text-align: center;
            color: #0d6efd;
            margin-bottom: 25px;
        }
        label {
            font-weight: 500;
        }
        .error {
            color: red;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="register-card">
        <h2><i class="fa fa-user-plus"></i> Ro‘yxatdan o‘tish</h2>

        <form method="post" enctype="multipart/form-data" id="registerForm">
            {% csrf_token %}

            <label for="id_username">Foydalanuvchi nomi</label>
            <input type="text" id="id_username" name="username" class="form-control" required>

            <label for="id_email">Email</label>
            <input type="email" id="id_email" name="email" class="form-control" required>

            <label for="id_user_type">Foydalanuvchi turi</label>
            <select id="id_user_type" name="user_type" class="form-select" required>
                <option value="">Tanlang...</option>
                <option value="sayohatchi">Sayohatchi</option>
                <option value="taxi_egasi">Taxi park egasi</option>
                <option value="gid">Gid (yo‘lboschi)</option>
                <option value="mehmonxona_egasi">Mehmonxona egasi</option>
            </select>

            <label for="id_phone">Telefon raqam</label>
            <input type="text" id="id_phone" name="phone" class="form-control" required>

            <label for="id_country">Davlat</label>
            <input type="text" id="id_country" name="country" class="form-control" required>

            <label for="id_city">Shahar</label>
            <input type="text" id="id_city" name="city" class="form-control" required>

            <label for="id_avatar">Profil rasmi</label>
            <input type="file" id="id_avatar" name="avatar" class="form-control">

            <label for="id_password1">Parol</label>
            <input type="password" id="id_password1" name="password1" class="form-control" required>

            <label for="id_password2">Parolni tasdiqlang</label>
            <input type="password" id="id_password2" name="password2" class="form-control" required>

            <div id="error-message" class="error text-center mb-2"></div>

            <button type="submit" class="btn btn-primary mt-3" id="registerBtn" disabled>
                <i class="fa fa-user-plus me-1"></i> Ro‘yxatdan o‘tish
            </button>

            <div class="text-center mt-3">
                <small>Allaqachon akkauntingiz bormi?
                    <a href="{% url 'login' %}" class="text-primary fw-bold">Kirish</a>
                </small>
            </div>
        </form>
    </div>

    <script>
        const form = document.getElementById('registerForm');
        const registerBtn = document.getElementById('registerBtn');
        const errorMsg = document.getElementById('error-message');
        const inputs = form.querySelectorAll('input[required], select[required]');
        const username = document.getElementById('id_username');
        const pass1 = document.getElementById('id_password1');
        const pass2 = document.getElementById('id_password2');

        function validateForm() {
            let allFilled = true;
            inputs.forEach(input => {
                if (!input.value.trim()) {
                    allFilled = false;
                }
            });

            let error = "";

            if (username.value !== username.value.toLowerCase()) {
                error = "⚠️ Foydalanuvchi nomi faqat kichik harflarda bo‘lishi kerak.";
            } else if (pass1.value && pass2.value && pass1.value !== pass2.value) {
                error = "⚠️ Parollar bir-biriga mos emas.";
            }

            if (error) {
                errorMsg.innerText = error;
                registerBtn.disabled = true;
            } else if (allFilled) {
                errorMsg.innerText = "";
                registerBtn.disabled = false;
            } else {
                registerBtn.disabled = true;
                errorMsg.innerText = "";
            }
        }

        form.addEventListener('input', validateForm);
    </script>
</body>
</html>
